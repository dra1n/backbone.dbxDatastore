!function(){"use strict";!function(a,b){var c,d;return"undefined"!=typeof exports&&null!==exports?(d=require("underscore"),c=require("backbone"),module.exports=b(d,c)):("undefined"!=typeof define&&null!==define?define.amd:void 0)?define(["underscore","backbone"],function(c,d){return b(c||a._,d||a.Backbone)}):b(a._,a.Backbone)}(this,function(a,b){return b.DbxDatastore=function(){function c(a){this.tableName=a}return c.prototype.create=function(a){var b;return b=this._getTable().insert(a.toJSON()),a.id=b.getId(),a.set(a.idAttribute,a.id),this.find(a)},c.prototype.update=function(a){return this._getRecord(a).update(a.toJSON()),this.find(a)},c.prototype.find=function(a){return this.jsonData(this._getRecord(a))},c.prototype.findAll=function(){var b=this;return a(this._getTable().query()).map(function(a){return b.jsonData(a)})},c.prototype.destroy=function(a){return a.isNew()?!1:(this._getRecord(a).deleteRecord(),a)},c.prototype.jsonData=function(a){var b;return null!=a&&(b=a.getFields(),b.id=a.getId()),b},c.prototype._getRecord=function(a){return this._getTable().get(a.id)},c.prototype._getTable=function(){return this._table||(this._table=b.DbxDatastore.datastore.getTable(this.tableName))},c.sync=function(a,c,d){var e,f,g,h,i,j;e=b.DbxDatastore.datastore,i=c.dbxDatastore||c.collection.DbxDatastore,j=b.$.Deferred&&b.$.Deferred();try{switch(a){case"read":h=null!=c.id?i.find(c):i.findAll();break;case"create":h=i.create(c);break;case"update":h=i.update(c);break;case"delete":h=i.destroy(c)}}catch(k){f=k,g=f.message}return null!=h?((null!=d?d.success:void 0)&&("0.9.10"===b.VERSION?d.success(c,h,d):d.success(h)),null!=j&&j.resolve(h)):(g=null!=g?g:"Record Not Found",(null!=d?d.error:void 0)&&("0.9.10"===b.VERSION?d.error(c,g,d):d.error(g)),null!=j&&j.reject(g)),(null!=d?d.complete:void 0)&&d.complete(h),null!=j?j.promise():void 0},c.datastore=null,c}(),b.ajaxSync=b.sync,b.getSyncMethod=function(a){var c;return a.dbxDatastore||(null!=(c=a.collection)?c.dbxDatastore:void 0)?b.DbxDatastore.sync:b.ajaxSync},b.sync=function(a,c,d){return b.getSyncMethod(c).apply(this,[a,c,d])},b.DbxDatastore})}.call(this);